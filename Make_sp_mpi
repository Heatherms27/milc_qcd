#  MIMD version 6
#  Standard application makefile for MPI on the SP
#  Do not use for making libraries
#  Copy this file into the application directory and run make there.
#

MAKEFILE = Make_sp_mpi
COMMTYPE = MPI

#----------------------------------------------------------------------
#  User choices - edit to suit 
#----------------------------------------------------------------------
# 1. Compiler
CC               = mpcc    # ( mpxlc mpcc_r xlc )

#----------------------------------------------------------------------
# 2. Compiler optimization level
OPT              = -O3    # ( -g -O, etc )

#----------------------------------------------------------------------
# 3. Other compiler optimization flags.  Uncomment stanza to suit.
#-------------- Blue Horizon -------------------------------------
CARCH = -qarch=pwr3 -qtune=pwr3   # Architecture: ( ppc pwr2 )
# For Blue Horizon (memory flags for 1 GByte)
OCFLAGS= ${CARCH} -Q=500 -qmaxmem=-1 -bmaxdata:0x40000000 -bmaxstack:0x8000000

#----------------------------------------------------------------------
# 4. Choose large file support
CLFS = -D_LARGE_FILES   # 

#----------------------------------------------------------------------
# 5. Installation-specific MPI includes and libraries (if not using mpicc)
#----------------- NCSA  ------------------------------------------
#CMPI = -I/usr/lpp/ppe.poe/include  # Use if not using mpcc
#LMPI = -L/usr/lpp/ppe.poe/lib -L/usr/lpp/ppe.poe/lib/ip -binitfini:poe_remote_main -lmpi_r -lvtd  # Use if not using mpcc or mpxlc

# 6. I/O routines
# Both io_nonansi and io_ansi should work on a scalar machine
# Solaris 2.6 gave "bad file number" errors with io_ansi.  CD
MACHINE_DEP_IO   = io_ansi.o  # standard - no parallel writes allowed
#MACHINE_DEP_IO   = io_romio.o # MPI-2 with GPFS (may not be better than serial)
#MACHINE_DEP_IO   = io_piofs.o -bI:/usr/include/piofs/piofs.exp # older IBM SP parallel IO File System

#----------------------------------------------------------------------
# 7. Linker
LD               = ${CC}

#----------------------------------------------------------------------
# 8. Extra linker flags
LDFLAGS          =           # most

#----------------------------------------------------------------------
# 9. Extra libraries
ILIB             = ${LMPI}    # not needed if using mpicc

#----------------------------------------------------------------------
# 10. Code alternatives 
CODETYPE         = -DINLINE -DNOPREFETCH

#----------------------------------------------------------------------
# 11. Choose MILC library make file in libraries directory.  
#    CHECK IT FOR FURTHER OPTIONS!

#MAKELIBRARIES = Make_vanilla # Must use this with double precision version
MAKELIBRARIES = Make_RS6K  # RS6000

#----------------------------------------------------------------------
# End of user choices.  Please, also, check include/config.h.
#----------------------------------------------------------------------
# Application-architecture-dependent routines
MACHINE_DEP = com_mpi.o ${MACHINE_DEP_IO}

# Complete set of compiler flags - do not change
CFLAGS = ${OPT} ${OCFLAGS} -D${COMMTYPE} ${CODETYPE} ${CLFS} ${CMPI} -I${MYINCLUDEDIR} ${DEFINES}

CFLAGS0 = -I${MYINCLUDEDIR} ${DEFINES}

include Make_template

